<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Unexpected Use of Zobrist Hashing :eyes: - Yufan&#39;s Blog</title><meta name="Description" content="A surprising place to use Zobrist Hashing, which is designed for board games"><meta property="og:title" content="Unexpected Use of Zobrist Hashing :eyes:" />
<meta property="og:description" content="A surprising place to use Zobrist Hashing, which is designed for board games" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yufannnn.github.io/posts/zobrist/zobrist/" /><meta property="og:image" content="http://yufannnn.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-23T22:38:56+08:00" /><meta property="og:site_name" content="Zhu Yufan&#39;s Blog" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://yufannnn.github.io/logo.png"/>

<meta name="twitter:title" content="Unexpected Use of Zobrist Hashing :eyes:"/>
<meta name="twitter:description" content="A surprising place to use Zobrist Hashing, which is designed for board games"/>
<meta name="application-name" content="Yufan&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Yufan&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#2b5797"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://yufannnn.github.io/posts/zobrist/zobrist/" /><link rel="prev" href="http://yufannnn.github.io/posts/detour/detour/" /><link rel="next" href="http://yufannnn.github.io/posts/ta/ta/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Unexpected Use of Zobrist Hashing :eyes:",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/yufannnn.github.io\/posts\/zobrist\/zobrist\/"
        },"genre": "posts","keywords": "computer science, curriculum","wordcount":  1070 ,
        "url": "http:\/\/yufannnn.github.io\/posts\/zobrist\/zobrist\/","datePublished": "2022-10-17T00:00:00+00:00","dateModified": "2022-12-23T22:38:56+08:00","license": "Zhu Yufan 2022","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "http:\/\/yufannnn.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Zhu Yufan"
            },"description": "A surprising place to use Zobrist Hashing, which is designed for board games"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Yufan&#39;s Blog"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Yufan&#39;s Blog"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Unexpected Use of Zobrist Hashing 👀</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Zhu Yufan</a></span>&nbsp;<span class="post-category">included in <a href="/categories/academia/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Academia</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-10-17">2022-10-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1070 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Zobrist.jpg"
        data-srcset="/Zobrist.jpg, /Zobrist.jpg 1.5x, /Zobrist.jpg 2x"
        data-sizes="auto"
        alt="/Zobrist.jpg"
        title="A surprising place to use Zobrist Hashing, which is designed for board games" width="573" height="480" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#my-initial-stereotype-about-zobrist-hashing">My Initial stereotype about Zobrist Hashing</a></li>
        <li><a href="#a-new-quest">A New Quest</a></li>
        <li><a href="#the-solution-10">The Solution 1.0</a></li>
        <li><a href="#the-problem">The Problem</a></li>
        <li><a href="#the-solution-20">The Solution 2.0</a></li>
        <li><a href="#the-implementation">The Implementation</a></li>
        <li><a href="#the-improvement">The Improvement</a></li>
        <li><a href="#to-be-continued-">To Be Continued &hellip;</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>This post is kind of a following up to the previous post. I found a surprising question where Zobrist hashing is applicable. Alert: this post is going to be a bit technical!</p>
<p>This post is kind of a following up to the previous post. In the previous post, I wrote about the AI agent I constructed for the CS2109S individual project to play the board game, Breakthrough. There is, however, one feature I didn&rsquo;t manage to implement, Zobrist Hashing, which supposedly can dramatically reduce the runtime and space complexity. I have read about the Zobrist Hashing Algorithm but decided to not actually implement it due to lack of time. Instead, I just used a very naive approach: represent the board using a string and directly hash the string representation of the board, which runs in O(n^2) as we have to go through the n * n every time to figure out its string representation.</p>
<div class="details admonition Note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>What is Zobrist Hashing?<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Zobrist hashing (also referred to as Zobrist keys or Zobrist signatures) is a hash function construction used in computer programs that play abstract board games, such as chess and Go, to implement transposition tables, a special kind of hash table that is indexed by a board position and used to avoid analyzing the same position more than once.</div>
        </div>
    </div>
<h3 id="my-initial-stereotype-about-zobrist-hashing">My Initial stereotype about Zobrist Hashing</h3>
<p>Upon reading Zobrist Hashing, I initially thought that this hashing algorithm is only dedicated to hashing for board games. I did not see how it could be used elsewhere as it seems to be so specifically designed for hashing board games.</p>
<h3 id="a-new-quest">A New Quest</h3>
<p>Several weeks later, the professor from another module that I concurrently took, CS3230 <em><strong>Design and Analysis of Algorithm</strong></em>, released a programming assignment. Here is the question of the assignment. Given an integer array of size n, find the number of balanced subarrays and output the number. An array is defined to be balanced if all the numbers in that array occur an even number of times (zero times included). For example, if the given array is [1, 1, 2, 3, 3, 2], the output should be 2 as we have subarray [1, 1] and [1, 1, 2, 3, 3, 2] being balanced. The algorithm should run in O(n^2) time complexity.</p>
<h3 id="the-solution-10">The Solution 1.0</h3>
<p>It didn&rsquo;t take me long to figure out a naive version of the solution. We can represent the whole configuration using a very long bit string, as long as the maximum number of the given array and set the bit string to be all zeros. Let the ith bit of the bit string represents the parity of number i in the array, 0 for even parity and 1 for odd parity. Every time we encounter a number, we just toggle the corresponding bit in the bit string to indicate a flip in parity. After changing the bit string for each number, we hash the current bit string and record the number for each bit representation. We can easily see that if we have two exactly the same bit strings, then the subarray in between them should be balanced. Therefore, after we loop through the whole array and get the number for each bit string, we simply have to find the summation of each count choose two. This is because by the argument before, we notice that for each pair of the same bit string the subarray between them is always balanced. Therefore, if we will find the total number of balanced subarrays, we need to calculate the number of distinct pairs for each bitstring and sum them up.</p>
<h3 id="the-problem">The Problem</h3>
<p>Seems to be pretty elegant, right? However, the problem is that the number in the given array can be extremely large, say 50,000. If we store the bitstring representation in the form of a series of long-type numbers, it means 391 long-type numbers are needed to store the representation! Since each long can represent 128 bits. Therefore, the space and time needed to hash all these values are going to be tremendous. Therefore, we need to figure out an even smarter solution.</p>
<h3 id="the-solution-20">The Solution 2.0</h3>
<p>As I only did the AI project one or two weeks ago, when sat down and reconsider the problem, I thought, &ldquo;Wait a minute, isn&rsquo;t this question a little bit similar to a board game&rdquo;. The essence of Zobrist Hashing is that in a board game, the board representation only changes minimally for every step, namely the move of a pawn. Therefore, we use the exclusive OR operation on the hash value of the previous step once to indicate the change to avoid repeated computation. The current problem shows much resemblance to the situation described above. When we loop through one element in the array, we only flip one bit of the bitstring, which is similar to the movement of a single pawn. Also, we don&rsquo;t care about the order or sequence of each bitstring representation; we only care about their counts. After I thought all these through, I then convinced myself that maybe Zobrist Hashing can actually be used in some other situations.</p>
<h3 id="the-implementation">The Implementation</h3>
<p>Instead of using a 391 longs combination as the representation. This time I long use a single long as the representation. We randomly initialize it first to avoid collision then find the largest element in the array and assign each number to a random long. The algorithm is rather straightforward, we simply loop through the array. When we encounter a number, we XOR it with our long representation and then hash the long representation, which is almost the same as the original version of Zobrist Hashing.</p>
<h3 id="the-improvement">The Improvement</h3>
<p>The improvement is unbelievable; the naive solution needs more than 20 seconds to solve an input of scale 50,000 while the Zobrist version only uses less than 3 seconds !!! I was wondering if I did not do the AI project several weeks ago, how would I even be able to link this problem with Zobrist hashing and come up with this elegant solution? It just struck me how amazing and flexible algorithms can be when it comes to problem-solving.</p>
<h3 id="to-be-continued-">To Be Continued &hellip;</h3>
<p>Lastly, after studying CS3230, I do wish to formally prove the runtime and the correctness of the algorithm but this post is already running a bit too long and too technical. Maybe, I will come back sometime and write a new post with the proof in the future!</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-12-23&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/d3db25ca19d259424e8b5338194f6526966508f2" target="_blank" title="commit by Yufannnn(e0773591@u.nus.edu) d3db25ca19d259424e8b5338194f6526966508f2: init commit">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>d3db25c</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:" data-via="ZYF_777" data-hashtags="computer science,curriculum"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-hashtag="computer science"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:" data-image="Zobrist.jpg"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 百度" data-sharer="baidu" data-url="http://yufannnn.github.io/posts/zobrist/zobrist/" data-title="Unexpected Use of Zobrist Hashing :eyes:"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/baidu.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/computer-science/">computer science</a>,&nbsp;<a href="/tags/curriculum/">curriculum</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/detour/detour/" class="prev" rel="prev" title="Detours I Have Taken When Trying to Build Muscle :worried:"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Detours I Have Taken When Trying to Build Muscle 😟</a>
            <a href="/posts/ta/ta/" class="next" rel="next" title="My Experience of being a Teaching Assistant in School of Computing :thinking:">My Experience of being a Teaching Assistant in School of Computing 🤔<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.109.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Zhu Yufan</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":20},"comment":{},"data":{"id-1":"Yufan's Blog","id-2":"Yufan's Blog"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
